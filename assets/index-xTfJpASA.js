(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))c(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&c(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function c(n){if(n.ep)return;n.ep=!0;const a=r(n);fetch(n.href,a)}})();function $(t){return t*Math.PI/180}function b(t){return t*180/Math.PI}function p(t,...e){return e.includes(t)}var h=(t=>(t.ADD="+",t.SUB="-",t.MUL="*",t.DIV="/",t.POW="^",t))(h||{});const w={exp:t=>Math.exp(t),log:t=>Math.log10(t),ln:t=>Math.log(t),deg:t=>b(t),rad:t=>$(t),sin:t=>Math.sin($(t)),cos:t=>Math.cos($(t)),tan:t=>Math.tan($(t)),asin:t=>b(Math.asin(t)),acos:t=>b(Math.acos(t)),atan:t=>b(Math.atan(t)),sqrt:t=>Math.sqrt(t)},L={pi:Math.PI,e:Math.E},F=0,S={fractionDigits:4};var o=(t=>(t[t.Number=0]="Number",t[t.UnaryOperator=1]="UnaryOperator",t[t.BinaryOperator=2]="BinaryOperator",t[t.OpenParen=3]="OpenParen",t[t.ClosedParen=4]="ClosedParen",t[t.Identifier=5]="Identifier",t[t.Constant=6]="Constant",t[t.Function=7]="Function",t[t.EOF=8]="EOF",t))(o||{});function d(t="",e){return{value:t,type:e}}function N(t){return/^[+-]$/.test(t)}function D(t){return N(t)||/^[*/^]$/.test(t)}function P(t){return/^[a-z]$/i.test(t)}function O(t){return/^\d$/.test(t)}function B(t){return/^\s$/.test(t)}function C(t){var u;const e=new Array;let r=0,c=!1,n="";function a(){let s="";for(;r<t.length&&(O(t[r])||t[r]==="."&&O(t[r+1]));)s+=t[r],r++;return s}function i(){let s="",l=!1;for(;r<t.length&&(P(t[r])||l&&O(t[r]));)l=!0,s+=t[r],r++;return s}for(;r<t.length;)if(t[r]==="(")c=!0,e.push(d(t[r++],3));else if(t[r]===")")c=!1,e.push(d(t[r++],4));else if(D(t[r]))N(t[r])&&(!e.at(-1)||p((u=e.at(-1))==null?void 0:u.type,2,3))?n=t[r++]:e.push(d(t[r++],2));else if(O(t[r])){const s=a();e.push(d(n+s,0)),n&&(n="")}else if(P(t[r])){const s=i();w[s]?e.push(d(s,7)):L[s]?e.push(d(s,6)):e.push(d(s,5))}else if(B(t[r]))r++;else throw new Error("Unexpected character '"+t[r]+"' near "+t.slice(0,Math.max(0,r)));if(c)throw new Error("Unexpected end of expression: "+t);return e.push(d("EOF",8)),e}let g;function v(t){return Number.parseFloat(t.toFixed(S.fractionDigits))}function M(t,e,r,c=!1){var u,s;c&&(g=0,c=!1);let n=F,a,i;switch(t.type){case o.Number:{n=Number.parseFloat(t.value),n=v(n),r.push(`${n}`);break}case o.BinaryOperator:{let l="";a=M(t.left,e,r),a=v(a);const f=p((u=t.left)==null?void 0:u.type,o.BinaryOperator,o.Function);f&&r.push(`#${++g}`),l=`(${f?"#"+g:a} ${t.operator} `,i=M(t.right,e,r),i=v(i);const m=p((s=t.right)==null?void 0:s.type,o.BinaryOperator,o.Function);switch(m&&r.push(`#${++g}`),l+=`${m?"#"+g:i})`,r.push(l),t.operator){case h.ADD:{n=a+i;break}case h.SUB:{n=a-i;break}case h.MUL:{n=a*i;break}case h.DIV:{n=a/i;break}case h.POW:{n=a**i;break}}n=v(n),r.push(`${n}`);break}case o.Function:{n=M(t.argument,e,r),n=v(n),r.push(`#${++g}`),r.push(`${t.name}(#${g})`),n=w[t.name](n),n=v(n),r.push(`${n}`);break}case o.Constant:{n=L[t.name],n=v(n),r.push(`${n}`);break}case o.Identifier:{n=e.variables[t.name]||F,r.push(`${n}`);break}default:throw new Error(`Unknown node type: ${t.type}`)}return n}function W(t=[]){let e=0;function r(){return t[e].type===o.EOF}function c(){var i,u,s;if(!r()&&p((i=t[e])==null?void 0:i.type,o.OpenParen)){e++;const l=a();return e++,l}else{if(p((u=t[e])==null?void 0:u.type,o.Number))return t[e++];if(p((s=t[e])==null?void 0:s.type,o.Identifier,o.Constant,o.Function)){const{type:l,value:f}=t[e++];if(l===o.Function){e++;const m=a();return e++,{type:l,name:f,argument:m}}return{type:l,name:f}}else throw new Error(`Unexpected token: ${t[e].value}`)}}function n(){let i=c();for(;!r()&&p(t[e].value,h.MUL,h.DIV,h.POW);){const u=t[e].value;e++;const s=c();i={type:o.BinaryOperator,operator:u,left:i,right:s}}return i}function a(){let i=n();for(;!r()&&p(t[e].value,h.ADD,h.SUB);){const u=t[e].value;e++;const s=n();i={type:o.BinaryOperator,operator:u,left:i,right:s}}return i}return a()}function U(t){return t=t.replace(/\(\((.*)\)\)/g,(e,r)=>r.includes("(")?e:e.slice(1,-1)),t.startsWith("(")?t.slice(1,-1):t}function q(t){if(!t.includes("#1")||t.length<2)return t.filter((i,u)=>i.startsWith("(")||u===t.length-1).map(i=>U(i));const e={};let r,c;for(const[i,u]of t.entries())u.startsWith("#")&&(r=t[i-2]||"",c=!r.startsWith("#")&&[...r].some(s=>D(s)||P(s)),e[u]={result:t[i-1],expr:c?r:""});const n=[];function a(i,u){let s=i;i&&(s=i.replaceAll(/#\d/g,l=>{var f;return((f=e[l])==null?void 0:f.result)||""}),i=i.replaceAll(/#\d/g,l=>{var f,m;return((f=e[l])==null?void 0:f.expr)||((m=e[l])==null?void 0:m.result)||""}),s!==i&&u.unshift(s),i.includes("#")||u.unshift(i)),i.includes("#")&&a(i,u)}return a(t.at(-2)||"",n),n.push(t.at(-1)),n.map(i=>U(i))}function A(t,e,r){const c=C(t),n=W(c);return M(n,e,r,!0)}function V(t){const e={variables:{}},r=t.trim().replace(/(\d)([a-z]|\()/gi,(a,i,u)=>i+"*"+u).split(`
`).filter(a=>{if(a=a.trim(),!a||a.startsWith("#"))return!1;const i=a.replaceAll(" ","").split(",");let u=!1,s;for(const l of i)if(s=l.match(/^([A-Za-z](\d+)?)=(.+)$/),s){if(L[s[1]]||w[s[1]])throw new Error(`Identifier '${s[1]}' is a builtin constant or function`);e.variables[s[1]]=A(s[3],e,[]),u=!0}return!u});let c=F,n=[];for(const a of r)c=A(a,e,n);return n=q(n),{value:c,scope:e,solution:n}}function z(t=""){let e=t.includes("#")?"":`<div>Solving: ${t}</div>`;try{const r=V(t);r.solution.length>2?(r.solution.forEach(c=>e+=`<div>= ${c}</div>`),e+=`<div><br/>Answer: ${r.value}</div>`):e+=`<div>Answer: ${r.value}</div>`}catch(r){e=`${r}`}return e}const I=document.querySelector("button"),E=document.querySelector("textarea"),y=document.querySelector("main");function H(){const t=E.value;y.innerHTML+=`<div class="right"><div>${t.replace(/\n/g,"<br/>")}</div></div>`;const e=z(t);y.innerHTML+=`<div class="left"><div>${e}</div></div>`,y.scrollTo(0,y.scrollHeight),E.value=""}I.addEventListener("click",()=>{E.value.length&&H()});E.addEventListener("keyup",t=>{t.ctrlKey&&t.key.toLowerCase()==="enter"&&(t.preventDefault(),I.click())});
